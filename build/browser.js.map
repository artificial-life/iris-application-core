{"version":3,"names":[],"mappings":"","sources":["browser.js"],"sourcesContent":["\"use strict\";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function _inherits(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _get=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,n,i)}if(\"value\"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(i)},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol?\"symbol\":typeof e};!function t(e,n,i){function r(o,a){if(!n[o]){if(!e[o]){var u=\"function\"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var c=new Error(\"Cannot find module '\"+o+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return r(n?n:t)},l,l.exports,t,e,n,i)}return n[o].exports}for(var s=\"function\"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){function i(){for(var e=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",t=0,n=e.length;t<n;++t)u[t]=e[t],c[e.charCodeAt(t)]=t;c[\"-\".charCodeAt(0)]=62,c[\"_\".charCodeAt(0)]=63}function r(e){var t,n,i,r,s,o,a=e.length;if(a%4>0)throw new Error(\"Invalid string. Length must be a multiple of 4\");s=\"=\"===e[a-2]?2:\"=\"===e[a-1]?1:0,o=new l(3*a/4-s),i=s>0?a-4:a;var u=0;for(t=0,n=0;t<i;t+=4,n+=3)r=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],o[u++]=r>>16&255,o[u++]=r>>8&255,o[u++]=255&r;return 2===s?(r=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,o[u++]=255&r):1===s&&(r=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,o[u++]=r>>8&255,o[u++]=255&r),o}function s(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}function o(e,t,n){for(var i,r=[],o=t;o<n;o+=3)i=(e[o]<<16)+(e[o+1]<<8)+e[o+2],r.push(s(i));return r.join(\"\")}function a(e){for(var t,n=e.length,i=n%3,r=\"\",s=[],a=16383,c=0,l=n-i;c<l;c+=a)s.push(o(e,c,c+a>l?l:c+a));return 1===i?(t=e[n-1],r+=u[t>>2],r+=u[t<<4&63],r+=\"==\"):2===i&&(t=(e[n-2]<<8)+e[n-1],r+=u[t>>10],r+=u[t>>4&63],r+=u[t<<2&63],r+=\"=\"),s.push(r),s.join(\"\")}n.toByteArray=r,n.fromByteArray=a;var u=[],c=[],l=\"undefined\"!=typeof Uint8Array?Uint8Array:Array;i()},{}],2:[function(e,t,n){(function(t){function i(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&\"function\"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}function r(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(r()<t)throw new RangeError(\"Invalid typed array length\");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,n){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,n);if(\"number\"==typeof e){if(\"string\"==typeof t)throw new Error(\"If encoding is specified then the first argument must be a string\");return l(this,e)}return a(this,e,t,n)}function a(e,t,n,i){if(\"number\"==typeof t)throw new TypeError('\"value\" argument must not be a number');return\"undefined\"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?d(e,t,n,i):\"string\"==typeof t?f(e,t,n):p(e,t)}function u(e){if(\"number\"!=typeof e)throw new TypeError('\"size\" argument must be a number')}function c(e,t,n,i){return u(t),t<=0?s(e,t):void 0!==n?\"string\"==typeof i?s(e,t).fill(n,i):s(e,t).fill(n):s(e,t)}function l(e,t){if(u(t),e=s(e,t<0?0:0|y(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t,n){if(\"string\"==typeof n&&\"\"!==n||(n=\"utf8\"),!o.isEncoding(n))throw new TypeError('\"encoding\" must be a valid string encoding');var i=0|g(t,n);return e=s(e,i),e.write(t,n),e}function h(e,t){var n=0|y(t.length);e=s(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function d(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError(\"'offset' is out of bounds\");if(t.byteLength<n+(i||0))throw new RangeError(\"'length' is out of bounds\");return t=void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=h(e,t),e}function p(e,t){if(o.isBuffer(t)){var n=0|y(t.length);return e=s(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if(\"undefined\"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||\"length\"in t)return\"number\"!=typeof t.length||X(t.length)?s(e,0):h(e,t);if(\"Buffer\"===t.type&&K(t.data))return h(e,t.data)}throw new TypeError(\"First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.\")}function y(e){if(e>=r())throw new RangeError(\"Attempt to allocate Buffer larger than maximum size: 0x\"+r().toString(16)+\" bytes\");return 0|e}function v(e){return+e!=e&&(e=0),o.alloc(+e)}function g(e,t){if(o.isBuffer(e))return e.length;if(\"undefined\"!=typeof ArrayBuffer&&\"function\"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;\"string\"!=typeof e&&(e=\"\"+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case\"ascii\":case\"binary\":case\"raw\":case\"raws\":return n;case\"utf8\":case\"utf-8\":case void 0:return N(e).length;case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return 2*n;case\"hex\":return n>>>1;case\"base64\":return V(e).length;default:if(i)return N(e).length;t=(\"\"+t).toLowerCase(),i=!0}}function k(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return\"\";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return\"\";if(n>>>=0,t>>>=0,n<=t)return\"\";for(e||(e=\"utf8\");;)switch(e){case\"hex\":return I(this,t,n);case\"utf8\":case\"utf-8\":return T(this,t,n);case\"ascii\":return q(this,t,n);case\"binary\":return R(this,t,n);case\"base64\":return S(this,t,n);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return O(this,t,n);default:if(i)throw new TypeError(\"Unknown encoding: \"+e);e=(e+\"\").toLowerCase(),i=!0}}function m(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function w(e,t,n,i){function r(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,o=e.length,a=t.length;if(void 0!==i&&(i=String(i).toLowerCase(),\"ucs2\"===i||\"ucs-2\"===i||\"utf16le\"===i||\"utf-16le\"===i)){if(e.length<2||t.length<2)return-1;s=2,o/=2,a/=2,n/=2}for(var u=-1,c=n;c<o;++c)if(r(e,c)===r(t,u===-1?0:c-u)){if(u===-1&&(u=c),c-u+1===a)return u*s}else u!==-1&&(c-=c-u),u=-1;return-1}function _(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i),i>r&&(i=r)):i=r;var s=t.length;if(s%2!==0)throw new Error(\"Invalid hex string\");i>s/2&&(i=s/2);for(var o=0;o<i;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[n+o]=a}return o}function b(e,t,n,i){return J(N(t,e.length-n),e,n,i)}function j(e,t,n,i){return J(Q(t),e,n,i)}function E(e,t,n,i){return j(e,t,n,i)}function P(e,t,n,i){return J(V(t),e,n,i)}function A(e,t,n,i){return J(H(t,e.length-n),e,n,i)}function S(e,t,n){return 0===t&&n===e.length?G.fromByteArray(e):G.fromByteArray(e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var s=e[r],o=null,a=s>239?4:s>223?3:s>191?2:1;if(r+a<=n){var u,c,l,f;switch(a){case 1:s<128&&(o=s);break;case 2:u=e[r+1],128===(192&u)&&(f=(31&s)<<6|63&u,f>127&&(o=f));break;case 3:u=e[r+1],c=e[r+2],128===(192&u)&&128===(192&c)&&(f=(15&s)<<12|(63&u)<<6|63&c,f>2047&&(f<55296||f>57343)&&(o=f));break;case 4:u=e[r+1],c=e[r+2],l=e[r+3],128===(192&u)&&128===(192&c)&&128===(192&l)&&(f=(15&s)<<18|(63&u)<<12|(63&c)<<6|63&l,f>65535&&f<1114112&&(o=f))}}null===o?(o=65533,a=1):o>65535&&(o-=65536,i.push(o>>>10&1023|55296),o=56320|1023&o),i.push(o),r+=a}return C(i)}function C(e){var t=e.length;if(t<=$)return String.fromCharCode.apply(String,e);for(var n=\"\",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=$));return n}function q(e,t,n){var i=\"\";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function R(e,t,n){var i=\"\";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function I(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r=\"\",s=t;s<n;++s)r+=z(e[s]);return r}function O(e,t,n){for(var i=e.slice(t,n),r=\"\",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}function B(e,t,n){if(e%1!==0||e<0)throw new RangeError(\"offset is not uint\");if(e+t>n)throw new RangeError(\"Trying to access beyond buffer length\")}function x(e,t,n,i,r,s){if(!o.isBuffer(e))throw new TypeError('\"buffer\" argument must be a Buffer instance');if(t>r||t<s)throw new RangeError('\"value\" argument is out of bounds');if(n+i>e.length)throw new RangeError(\"Index out of range\")}function D(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,s=Math.min(e.length-n,2);r<s;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function L(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,s=Math.min(e.length-n,4);r<s;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function U(e,t,n,i,r,s){if(n+i>e.length)throw new RangeError(\"Index out of range\");if(n<0)throw new RangeError(\"Index out of range\")}function W(e,t,n,i,r){return r||U(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),Z.write(e,t,n,i,23,4),n+4}function M(e,t,n,i,r){return r||U(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),Z.write(e,t,n,i,52,8),n+8}function F(e){if(e=Y(e).replace(ee,\"\"),e.length<2)return\"\";for(;e.length%4!==0;)e+=\"=\";return e}function Y(e){return e.trim?e.trim():e.replace(/^\\s+|\\s+$/g,\"\")}function z(e){return e<16?\"0\"+e.toString(16):e.toString(16)}function N(e,t){t=t||1/0;for(var n,i=e.length,r=null,s=[],o=0;o<i;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error(\"Invalid code point\");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function Q(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function H(e,t){for(var n,i,r,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),i=n>>8,r=n%256,s.push(r),s.push(i);return s}function V(e){return G.toByteArray(F(e))}function J(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function X(e){return e!==e}var G=e(\"base64-js\"),Z=e(\"ieee754\"),K=e(\"isarray\");n.Buffer=o,n.SlowBuffer=v,n.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:i(),n.kMaxLength=r(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,n){return a(null,e,t,n)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,\"undefined\"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,n){return c(null,e,t,n)},o.allocUnsafe=function(e){return l(null,e)},o.allocUnsafeSlow=function(e){return l(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError(\"Arguments must be Buffers\");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case\"hex\":case\"utf8\":case\"utf-8\":case\"ascii\":case\"binary\":case\"base64\":case\"raw\":case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return!0;default:return!1}},o.concat=function(e,t){if(!K(e))throw new TypeError('\"list\" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=o.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var s=e[n];if(!o.isBuffer(s))throw new TypeError('\"list\" argument must be an Array of Buffers');s.copy(i,r),r+=s.length}return i},o.byteLength=g,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError(\"Buffer size must be a multiple of 16-bits\");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError(\"Buffer size must be a multiple of 32-bits\");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?\"\":0===arguments.length?T(this,0,e):k.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError(\"Argument must be a Buffer\");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e=\"\",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString(\"hex\",0,t).match(/.{2}/g).join(\" \"),this.length>t&&(e+=\" ... \")),\"<Buffer \"+e+\">\"},o.prototype.compare=function(e,t,n,i,r){if(!o.isBuffer(e))throw new TypeError(\"Argument must be a Buffer\");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError(\"out of range index\");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var s=r-i,a=n-t,u=Math.min(s,a),c=this.slice(i,r),l=e.slice(t,n),f=0;f<u;++f)if(c[f]!==l[f]){s=c[f],a=l[f];break}return s<a?-1:a<s?1:0},o.prototype.indexOf=function(e,t,n){if(\"string\"==typeof t?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t>>=0,0===this.length)return-1;if(t>=this.length)return-1;if(t<0&&(t=Math.max(this.length+t,0)),\"string\"==typeof e&&(e=o.from(e,n)),o.isBuffer(e))return 0===e.length?-1:w(this,e,t,n);if(\"number\"==typeof e)return o.TYPED_ARRAY_SUPPORT&&\"function\"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,e,t):w(this,[e],t,n);throw new TypeError(\"val must be string, number or Buffer\")},o.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},o.prototype.write=function(e,t,n,i){if(void 0===t)i=\"utf8\",n=this.length,t=0;else if(void 0===n&&\"string\"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error(\"Buffer.write(string, encoding, offset[, length]) is no longer supported\");t=0|t,isFinite(n)?(n=0|n,void 0===i&&(i=\"utf8\")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError(\"Attempt to write outside buffer bounds\");i||(i=\"utf8\");for(var s=!1;;)switch(i){case\"hex\":return _(this,e,t,n);case\"utf8\":case\"utf-8\":return b(this,e,t,n);case\"ascii\":return j(this,e,t,n);case\"binary\":return E(this,e,t,n);case\"base64\":return P(this,e,t,n);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return A(this,e,t,n);default:if(s)throw new TypeError(\"Unknown encoding: \"+i);i=(\"\"+i).toLowerCase(),s=!0}},o.prototype.toJSON=function(){return{type:\"Buffer\",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var i;if(o.TYPED_ARRAY_SUPPORT)i=this.subarray(e,t),i.__proto__=o.prototype;else{var r=t-e;i=new o(r,(void 0));for(var s=0;s<r;++s)i[s]=this[s+e]}return i},o.prototype.readUIntLE=function(e,t,n){e=0|e,t=0|t,n||B(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i},o.prototype.readUIntBE=function(e,t,n){e=0|e,t=0|t,n||B(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},o.prototype.readUInt8=function(e,t){return t||B(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||B(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||B(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e=0|e,t=0|t,n||B(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},o.prototype.readIntBE=function(e,t,n){e=0|e,t=0|t,n||B(e,t,this.length);for(var i=t,r=1,s=this[e+--i];i>0&&(r*=256);)s+=this[e+--i]*r;return r*=128,s>=r&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return t||B(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},o.prototype.readInt16LE=function(e,t){t||B(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||B(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||B(e,4,this.length),Z.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||B(e,4,this.length),Z.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||B(e,8,this.length),Z.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||B(e,8,this.length),Z.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=0|t,n=0|n,!i){var r=Math.pow(2,8*n)-1;x(this,e,t,n,r,0)}var s=1,o=0;for(this[t]=255&e;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=0|t,n=0|n,!i){var r=Math.pow(2,8*n)-1;x(this,e,t,n,r,0)}var s=n-1,o=1;for(this[t+s]=255&e;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=0|t,!i){var r=Math.pow(2,8*n-1);x(this,e,t,n,r-1,-r)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},o.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=0|t,!i){var r=Math.pow(2,8*n-1);x(this,e,t,n,r-1,-r)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t=0|t,n||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return W(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return W(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return M(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return M(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError(\"targetStart out of bounds\");if(n<0||n>=this.length)throw new RangeError(\"sourceStart out of bounds\");if(i<0)throw new RangeError(\"sourceEnd out of bounds\");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,s=i-n;if(this===e&&n<t&&t<i)for(r=s-1;r>=0;--r)e[r+t]=this[r+n];else if(s<1e3||!o.TYPED_ARRAY_SUPPORT)for(r=0;r<s;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},o.prototype.fill=function(e,t,n,i){if(\"string\"==typeof e){if(\"string\"==typeof t?(i=t,t=0,n=this.length):\"string\"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&\"string\"!=typeof i)throw new TypeError(\"encoding must be a string\");if(\"string\"==typeof i&&!o.isEncoding(i))throw new TypeError(\"Unknown encoding: \"+i)}else\"number\"==typeof e&&(e=255&e);if(t<0||this.length<t||this.length<n)throw new RangeError(\"Out of range index\");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var s;if(\"number\"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=o.isBuffer(e)?e:N(new o(e,i).toString()),u=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%u]}return this};var ee=/[^+\\/0-9A-Za-z-_]/g}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"base64-js\":1,ieee754:4,isarray:14}],3:[function(e,t,n){!function(e){function i(){this._events={},this._conf&&r.call(this,this._conf)}function r(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function s(e){this._events={},this.newListener=!1,r.call(this,e)}function o(e,t,n,i){if(!n)return[];var r,s,a,u,c,l,f,h=[],d=t.length,p=t[i],y=t[i+1];if(i===d&&n._listeners){if(\"function\"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(r=0,s=n._listeners.length;r<s;r++)e&&e.push(n._listeners[r]);return[n]}if(\"*\"===p||\"**\"===p||n[p]){if(\"*\"===p){for(a in n)\"_listeners\"!==a&&n.hasOwnProperty(a)&&(h=h.concat(o(e,t,n[a],i+1)));return h}if(\"**\"===p){f=i+1===d||i+2===d&&\"*\"===y,f&&n._listeners&&(h=h.concat(o(e,t,n,d)));for(a in n)\"_listeners\"!==a&&n.hasOwnProperty(a)&&(\"*\"===a||\"**\"===a?(n[a]._listeners&&!f&&(h=h.concat(o(e,t,n[a],d))),h=h.concat(o(e,t,n[a],i))):h=a===y?h.concat(o(e,t,n[a],i+2)):h.concat(o(e,t,n[a],i)));return h}h=h.concat(o(e,t,n[p],i+1))}if(u=n[\"*\"],u&&o(e,t,u,i+1),c=n[\"**\"])if(i<d){c._listeners&&o(e,t,c,d);for(a in c)\"_listeners\"!==a&&c.hasOwnProperty(a)&&(a===y?o(e,t,c[a],i+2):a===p?o(e,t,c[a],i+1):(l={},l[a]=c[a],o(e,t,{\"**\":l},i+1)))}else c._listeners?o(e,t,c,d):c[\"*\"]&&c[\"*\"]._listeners&&o(e,t,c[\"*\"],d);return h}function a(e,t){e=\"string\"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,i=e.length;n+1<i;n++)if(\"**\"===e[n]&&\"**\"===e[n+1])return;for(var r=this.listenerTree,s=e.shift();s;){if(r[s]||(r[s]={}),r=r[s],0===e.length){if(r._listeners){if(\"function\"==typeof r._listeners)r._listeners=[r._listeners,t];else if(u(r._listeners)&&(r._listeners.push(t),!r._listeners.warned)){var o=c;\"undefined\"!=typeof this._events.maxListeners&&(o=this._events.maxListeners),o>0&&r._listeners.length>o&&(r._listeners.warned=!0,console.error(\"(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.\",r._listeners.length),console.trace&&console.trace())}}else r._listeners=t;return!0}s=e.shift()}return!0}var u=Array.isArray?Array.isArray:function(e){return\"[object Array]\"===Object.prototype.toString.call(e)},c=10;s.EventEmitter2=s,s.prototype.delimiter=\".\",s.prototype.setMaxListeners=function(e){this._events||i.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},s.prototype.event=\"\",s.prototype.once=function(e,t){return this.many(e,1,t),this},s.prototype.many=function(e,t,n){function i(){0===--t&&r.off(e,i),n.apply(this,arguments)}var r=this;if(\"function\"!=typeof n)throw new Error(\"many only accepts instances of Function\");return i._origin=n,this.on(e,i),r},s.prototype.emit=function(){this._events||i.call(this);var e=arguments[0];if(\"newListener\"===e&&!this.newListener&&!this._events.newListener)return!1;var t,n,r,s,a,u=arguments.length;if(this._all&&this._all.length){if(a=this._all.slice(),u>3)for(t=new Array(u),s=1;s<u;s++)t[s]=arguments[s];for(r=0,n=a.length;r<n;r++)switch(this.event=e,u){case 1:a[r].call(this,e);break;case 2:a[r].call(this,e,arguments[1]);break;case 3:a[r].call(this,e,arguments[1],arguments[2]);break;default:a[r].apply(this,t)}}if(this.wildcard){a=[];var c=\"string\"==typeof e?e.split(this.delimiter):e.slice();o.call(this,a,c,this.listenerTree,0)}else{if(a=this._events[e],\"function\"==typeof a){switch(this.event=e,u){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(u-1),s=1;s<u;s++)t[s-1]=arguments[s];a.apply(this,t)}return!0}a&&(a=a.slice())}if(a&&a.length){if(u>3)for(t=new Array(u-1),s=1;s<u;s++)t[s-1]=arguments[s];for(r=0,n=a.length;r<n;r++)switch(this.event=e,u){case 1:a[r].call(this);break;case 2:a[r].call(this,arguments[1]);break;case 3:a[r].call(this,arguments[1],arguments[2]);break;default:a[r].apply(this,t)}return!0}if(!this._all&&\"error\"===e)throw arguments[1]instanceof Error?arguments[1]:new Error(\"Uncaught, unspecified 'error' event.\");return!!this._all},s.prototype.emitAsync=function(){this._events||i.call(this);var e=arguments[0];if(\"newListener\"===e&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,n,r,s,a,u=[],c=arguments.length;if(this._all){if(c>3)for(t=new Array(c),s=1;s<c;s++)t[s]=arguments[s];for(r=0,n=this._all.length;r<n;r++)switch(this.event=e,c){case 1:u.push(this._all[r].call(this,e));break;case 2:u.push(this._all[r].call(this,e,arguments[1]));break;case 3:u.push(this._all[r].call(this,e,arguments[1],arguments[2]));break;default:u.push(this._all[r].apply(this,t))}}if(this.wildcard){a=[];var l=\"string\"==typeof e?e.split(this.delimiter):e.slice();o.call(this,a,l,this.listenerTree,0)}else a=this._events[e];if(\"function\"==typeof a)switch(this.event=e,c){case 1:u.push(a.call(this));break;case 2:u.push(a.call(this,arguments[1]));break;case 3:u.push(a.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(c-1),s=1;s<c;s++)t[s-1]=arguments[s];u.push(a.apply(this,t))}else if(a&&a.length){if(c>3)for(t=new Array(c-1),s=1;s<c;s++)t[s-1]=arguments[s];for(r=0,n=a.length;r<n;r++)switch(this.event=e,c){case 1:u.push(a[r].call(this));break;case 2:u.push(a[r].call(this,arguments[1]));break;case 3:u.push(a[r].call(this,arguments[1],arguments[2]));break;default:u.push(a[r].apply(this,t))}}else if(!this._all&&\"error\"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject(\"Uncaught, unspecified 'error' event.\");return Promise.all(u)},s.prototype.on=function(e,t){if(\"function\"==typeof e)return this.onAny(e),this;if(\"function\"!=typeof t)throw new Error(\"on only accepts instances of Function\");if(this._events||i.call(this),this.emit(\"newListener\",e,t),this.wildcard)return a.call(this,e,t),this;if(this._events[e]){if(\"function\"==typeof this._events[e])this._events[e]=[this._events[e],t];else if(u(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var n=c;\"undefined\"!=typeof this._events.maxListeners&&(n=this._events.maxListeners),n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error(\"(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.\",this._events[e].length),console.trace&&console.trace())}}else this._events[e]=t;return this},s.prototype.onAny=function(e){if(\"function\"!=typeof e)throw new Error(\"onAny only accepts instances of Function\");return this._all||(this._all=[]),this._all.push(e),this},s.prototype.addListener=s.prototype.on,s.prototype.off=function(t,n){function i(t){if(t!==e){var n=Object.keys(t);for(var r in n){var s=n[r],o=t[s];o instanceof Function||\"object\"!==(\"undefined\"==typeof o?\"undefined\":_typeof(o))||(Object.keys(o).length>0&&i(t[s]),0===Object.keys(o).length&&delete t[s])}}}if(\"function\"!=typeof n)throw new Error(\"removeListener only takes instances of Function\");var r,s=[];if(this.wildcard){var a=\"string\"==typeof t?t.split(this.delimiter):t.slice();s=o.call(this,null,a,this.listenerTree,0)}else{if(!this._events[t])return this;r=this._events[t],s.push({_listeners:r})}for(var c=0;c<s.length;c++){var l=s[c];if(r=l._listeners,u(r)){for(var f=-1,h=0,d=r.length;h<d;h++)if(r[h]===n||r[h].listener&&r[h].listener===n||r[h]._origin&&r[h]._origin===n){f=h;break}if(f<0)continue;return this.wildcard?l._listeners.splice(f,1):this._events[t].splice(f,1),0===r.length&&(this.wildcard?delete l._listeners:delete this._events[t]),this.emit(\"removeListener\",t,n),this}(r===n||r.listener&&r.listener===n||r._origin&&r._origin===n)&&(this.wildcard?delete l._listeners:delete this._events[t],this.emit(\"removeListener\",t,n))}return i(this.listenerTree),this},s.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,i=t.length;n<i;n++)if(e===t[n])return t.splice(n,1),this.emit(\"removeListenerAny\",e),this}else{for(t=this._all,n=0,i=t.length;n<i;n++)this.emit(\"removeListenerAny\",t[n]);this._all=[]}return this},s.prototype.removeListener=s.prototype.off,s.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||i.call(this),this;if(this.wildcard)for(var t=\"string\"==typeof e?e.split(this.delimiter):e.slice(),n=o.call(this,null,t,this.listenerTree,0),r=0;r<n.length;r++){var s=n[r];s._listeners=null}else{if(!this._events||!this._events[e])return this;this._events[e]=null}return this},s.prototype.listeners=function(e){if(this.wildcard){var t=[],n=\"string\"==typeof e?e.split(this.delimiter):e.slice();return o.call(this,t,n,this.listenerTree,0),t}return this._events||i.call(this),this._events[e]||(this._events[e]=[]),u(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},s.prototype.listenersAny=function(){return this._all?this._all:[]},\"function\"==typeof define&&define.amd?define(function(){return s}):\"object\"===(\"undefined\"==typeof n?\"undefined\":_typeof(n))?t.exports=s:window.EventEmitter2=s}()},{}],4:[function(e,t,n){n.read=function(e,t,n,i,r){var s,o,a=8*r-i-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?r-1:0,h=n?-1:1,d=e[t+f];for(f+=h,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=256*s+e[t+f],f+=h,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=i;l>0;o=256*o+e[t+f],f+=h,l-=8);if(0===s)s=1-c;else{if(s===u)return o?NaN:(d?-1:1)*(1/0);o+=Math.pow(2,i),s-=c}return(d?-1:1)*o*Math.pow(2,s-i)},n.write=function(e,t,n,i,r,s){var o,a,u,c=8*s-r-1,l=(1<<c)-1,f=l>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:s-1,p=i?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),\nt*(u=Math.pow(2,-o))<1&&(o--,u*=2),t+=o+f>=1?h/u:h*Math.pow(2,1-f),t*u>=2&&(o++,u/=2),o+f>=l?(a=0,o=l):o+f>=1?(a=(t*u-1)*Math.pow(2,r),o+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,r),o=0));r>=8;e[n+d]=255&a,d+=p,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;e[n+d]=255&o,d+=p,o/=256,c-=8);e[n+d-p]|=128*y}},{}],5:[function(e,t,n){t.exports={}},{}],6:[function(e,t,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],7:[function(e,t,n){t.exports={login:e(\"./login.js\"),control_panel:e(\"./control-panel.js\"),digital_display:e(\"./digital-display.js\"),qa:e(\"./qa.js\"),queue:e(\"./queue.js\"),roomdisplay:e(\"./roomdisplay.js\"),terminal:e(\"./terminal.js\")}},{\"./control-panel.js\":5,\"./digital-display.js\":6,\"./login.js\":8,\"./qa.js\":9,\"./queue.js\":10,\"./roomdisplay.js\":11,\"./terminal.js\":12}],8:[function(e,t,n){t.exports={11:{ru:\"неверный пароль\",en:\"incorrect password\"},12:{ru:\"пользователь не найден\",en:\"no such user\"},13:{ru:\"ошибка сервера\",en:\"internal error\"},14:{ru:\"внутренняя ошибка приложения\",en:\"unknown\"},15:{ru:\"неизвестная ошибка\",en:\"operation timeout\"},16:{ru:\"превышено время ожидания\",en:\"ws unavailable\"},17:{ru:\"рабочее место недоступно данному оператору\",en:\"application error\"},18:{ru:\"рабочее место занято другим оператором\",en:\"workstation is already occupied\"}}},{}],9:[function(e,t,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],10:[function(e,t,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],11:[function(e,t,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],12:[function(e,t,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],13:[function(e,t,n){t.exports=e(\"./Enchiridion/index.js\")},{\"./Enchiridion/index.js\":7}],14:[function(e,t,n){var i={}.toString;t.exports=Array.isArray||function(e){return\"[object Array]\"==i.call(e)}},{}],15:[function(e,t,n){window.IRIS=e(\"./iris.js\")},{\"./iris.js\":40}],16:[function(e,t,n){(function(n){function i(e){var t=r.upperFirst(r.camelCase(e+\"-workstation\"));return window.IRIS[t]}var r=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,s=\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof n?n.Promise:null,o=e(\"eventemitter2\").EventEmitter2,a=e(\"./access-objects/Settings.js\"),u=e(\"./access-objects/connection-instance.js\"),c=new u,l=new a,f=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{maxListeners:100}));return n.fields={},n.workstation_types=e,n.occupied_workstations=[],n}return _inherits(t,e),_createClass(t,[{key:\"getId\",value:function(){return this.fields.id}},{key:\"getWorkstation\",value:function(e){return r.find(this.occupied_workstations,function(t){return t.type==e})}},{key:\"getAvailableWorkstationTypes\",value:function(){return r.chain(this.fields.workstations.available).values().uniqBy(\"device_type\").map(\"device_type\").value()}},{key:\"getWorkstationById\",value:function(e){return r.find(this.occupied_workstations,function(t){return t.getId()==e})}},{key:\"login\",value:function(e,t,n){var i=this,r=c.request(\"/login\",{user:e,password:t},\"http\").then(function(e){return console.log(\"login result\",e),e}).then(function(e){return e.state?c.setToken(e.value.token):s.reject(e)}).then(function(){return c.request(\"/agent/info\",n)}).then(function(e){return i.setFields(e)}).then(function(){return i.initWS()}).then(function(){return i.emit(\"user.fields.changed\",i.fields),!0});return r[\"catch\"](function(e){throw i.clearFields(),console.log(\"Login error\"),e}),r}},{key:\"isLogged\",value:function(){return!!this.fields.logged_in}},{key:\"isPaused\",value:function(){return!!this.fields.paused}},{key:\"logout\",value:function(){var e=this,t=r.map(this.occupied_workstations,function(e){return e.getId()});return c.request(\"/logout\",{workstation:t}).then(function(t){if(console.log(\"<User> logout %s\",t.success?\"success\":\"failed\"),t.success)try{window.location.reload()}catch(n){console.log(\"Yeap, we are not in browser\")}finally{return s.resolve(!0).delay(1e3)}return t.success?s.map(e.occupied_workstations,function(e){return e.cleanUp()}):s.reject(t)}).then(function(){e.notifyLeave(e.occupied_workstations),e.clearFields(),console.log(\"done\")})}},{key:\"clearFields\",value:function(){return this.fields={logged_in:!1},this.occupied_workstations=[],c.close(),this.emit(\"user.fields.changed\",this.fields),!0}},{key:\"leave\",value:function(e){var t=this,n=e?r.map(r.castArray(e),function(e){return t.getWorkstationById(e)}):this.occupied_workstations,i=r.map(n,function(e){return e.leave()});return s.all(i).then(function(e){return r.remove(t.occupied_workstations,function(t){return~r.indexOf(e,t.getId())}),t.notifyLeave(e),!0})}},{key:\"notifyLeave\",value:function(e){var t=this;r.chain(e).map(function(e){return r.isObject(e)?e.id:e}).forEach(function(e){return t.emit(\"workstation.leave\",{id:e})}).value()}},{key:\"switchTo\",value:function(e,t){var n=this;return this.leave(t).then(function(){return n.initWS(r.castArray(e))})}},{key:\"takeBreak\",value:function(){return this.isPaused()?this.resume():this.pause()}},{key:\"pause\",value:function(){var e=this,t=r.map(this.occupied_workstations,function(e){return e.id});return c.request(\"/agent/pause\",{workstation:t}).then(function(t){return t.method=\"pause\",t.success&&(e.fields.paused=!e.fields.paused,e.emit(\"user.fields.changed\",e.fields)),t})}},{key:\"resume\",value:function(){var e=this,t=r.map(this.occupied_workstations,function(e){return e.id});return c.request(\"/agent/resume\",{workstation:t}).then(function(t){return t.method=\"resume\",t.success&&(e.fields.paused=!1,e.emit(\"user.fields.changed\",e.fields)),t})}},{key:\"setFields\",value:function(e){return console.log(\"Fields from agent\",e),this.fields.logged_in=!0,this.fields.paused=!1,this.id=e.entity.id,this.fields.name=e.entity.first_name,this.fields.lastname=e.entity.last_name,this.fields.middlename=e.entity.middle_name,this.fields.default_workstation=e.entity.default_workstation||[],this.fields.permissions=e.entity.permissions,this.fields.workstations=Object.create(null),this.fields.workstations.available=e.ws_available,!0}},{key:\"getSelectedWorkstation\",value:function(){var e=r.castArray(this.fields.default_workstation),t=this.getAvailableWorkstations(),n=r.chain(this.workstation_types).castArray().reduce(function(e,n){var i=l.getItem(n+\"_arm_id\");if(i&&!t[i])throw new Error(\"ws anavailable\");return i&&e.push(i),e},[]).value();return r.concat(n,e)}},{key:\"getSelectedWorkstationTypes\",value:function(){var e=this.getSelectedWorkstation(),t=this.getAvailableWorkstations();return e=r.isEmpty(e)?this.getDefaultWorkstaions():e,r.reduce(e,function(e,n){return t[n]&&e.push(t[n].device_type),e},[])}},{key:\"getDefaultWorkstaions\",value:function(){console.log(\"Allowed types:\",this.workstation_types);var e=this.fields.workstations.available,t=this.getSelectedWorkstation(),n=r.reduce(t,function(t,n){var i=e[n];return i?(t[i.device_type]=t[i.device_type]||n,t):t},{});if(!r.isEmpty(n))return r.values(n);var i=r.keys(e).slice(0,1);return i}},{key:\"getAvailableWorkstations\",value:function(){return this.fields.workstations.available}},{key:\"initWS\",value:function(e){var t=this;this.fields.paused=!1;var n=this.fields.workstations.available,o=e||this.getDefaultWorkstaions(),a=r.map(o,function(e){var s=n[e];if(r.isEmpty(s))throw new Error(\"WS anavailable\");var o=i(s.device_type),a=new o(t);return a.init(e,s).then(function(n){return console.log(\"<User> Emit Occupy #%s\",e),t.occupied_workstations.push(a),t.emit(\"workstation.occupy\",{id:e,type:s.device_type}),n})});return s.all(a)}}]),t}(o);t.exports=f}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"./access-objects/Settings.js\":21,\"./access-objects/connection-instance.js\":24,eventemitter2:3}],17:[function(e,t,n){(function(n){var i=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,r=\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof n?n.Promise:null,s=e(\"eventemitter2\").EventEmitter2,o=e(\"./Settings.js\"),a=new o,u=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.methods={},e.token=!1,e}return _inherits(t,e),_createClass(t,[{key:\"addConnectionProvider\",value:function(e){var t=this,n=a.getItem(\"api_port\"),r=a.getItem(\"api_server\"),s=i.isFunction(e)?new e(r,n):e.getMethod(r,n);console.log(\"Connection: method added %s on ip %s:%s\",s.name,r,n),i.isFunction(s.onDisconnect)&&s.onDisconnect(function(e){console.log(\"Connection method %s. Disconnect, coz %s\",s.name,e),t.emit(\"connection-shutdown\",{method:s.name,reason:e})}),i.isFunction(s.onRestore)&&s.onRestore(function(){console.log(\"Connection method %s. Restored.\",s.name),t.emit(\"connection-restore\",{method:s.name})}),this.methods[s.name]=s,this.current_method=s.name}},{key:\"getMethod\",value:function(e){var t=e||this.current_method;return this.methods[t]}},{key:\"setToken\",value:function(e){if(this.token=e||!1,!e)return r.reject({reason:\"Invalid token\"});var t=i.map(this.methods,function(t){return t.auth(e)});return r.all(t)}},{key:\"request\",value:function(e,t,n,i){return this.getMethod(n).request(e,t,i)}},{key:\"subscribe\",value:function(e,t,n){return this.getMethod(n).subscribe(e,t)}},{key:\"unsubscribe\",value:function(e,t,n){return this.getMethod(n).unsubscribe(e,t)}},{key:\"close\",value:function(){return i.map(this.methods,function(e){return e.close()})}}]),t}(s);t.exports=u}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"./Settings.js\":21,eventemitter2:3}],18:[function(e,t,n){(function(n){var i=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,r=e(\"iris-error-codes\"),s={en:\"Unknown_error\",ru:\"Неизвестная ошибка\"},o=function(){function e(){throw _classCallCheck(this,e),new Error(\"singletone\")}return _createClass(e,null,[{key:\"getByCode\",value:function(e,t){var n=i.get(r,[e,t]);return n||s}}]),e}();t.exports=o}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"iris-error-codes\":13}],19:[function(e,t,n){(function(e){function n(e,t){return 0!==e.indexOf(\"http\")&&(e=\"http://\"+e),{name:\"http\",auth:function(e){return this.token=e,i.resolve(!0)},close:function(){return i.resolve(!0)},request:function(n,i){i.token=this.token,console.log(n,i);var s={method:\"POST\",body:JSON.stringify(i),headers:{\"Content-Type\":\"application/json\"}},o=(e?e:\"\")+(t?\":\"+t:\"\")+n;return r(o,s).then(function(e){return e.json()})[\"catch\"](function(e){throw new Error(\"failed to fetch\")})},subscribe:function(e,t){throw new Error(\"not implemented yet\")},unsubscribe:function(e,t){throw new Error(\"not implemented yet\")}}}var i=(\"undefined\"!=typeof window?window._:\"undefined\"!=typeof e?e._:null,\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof e?e.Promise:null),r=\"undefined\"!=typeof window?window.fetch:\"undefined\"!=typeof e?e.fetch:null;t.exports=n}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],20:[function(e,t,n){var i=[],r=function(){function e(){_classCallCheck(this,e),this.on=!0}return _createClass(e,[{key:\"warn\",value:function(e){var t=e.join(\" \"),n=\"warn\";return this.addHistoryRecord(n,t)}},{key:\"error\",value:function(e){var t=e.join(\" \"),n=\"error\";return this.addHistoryRecord(n,t)}},{key:\"log\",value:function(e){var t=e.join(\" \"),n=\"log\";return this.addHistoryRecord(n,t)}},{key:\"addHistoryRecord\",value:function(e,t,n){this.on&&i.push({type:e,message:t,details:n})}},{key:\"getHistoryPage\",value:function(e,t,n){return i}},{key:\"flush\",value:function(){}},{key:\"flushByTime\",value:function(){}}]),e}();t.exports=r},{}],21:[function(e,t,n){(function(e){var n=\"undefined\"!=typeof window?window.localStorage:\"undefined\"!=typeof e?e.localStorage:null,i=function(){function e(t){_classCallCheck(this,e),this.defaults={},this.addDesc(t||{})}return _createClass(e,[{key:\"addDesc\",value:function(e){var t=this;this.description=_.reduce(e,function(e,n){var i=_.reduce(n.items,function(e,n,i){var r=n.element||\"input\",s=\"is\"+_.capitalize(r);return n[s]=!0,n.name=i,e.push(n),t.defaults[i]=n[\"default\"],e},[]);return e.push({items:i,name:n.name}),e},[])}},{key:\"setItem\",value:function(e,t){return n.setItem(e,t)}},{key:\"getItem\",value:function(e){var t=n.getItem(e);return null===t?this.getDefaults(e):t}},{key:\"getDefaults\",value:function(e){return this.defaults[e]}},{key:\"setDefaults\",value:function(e,t){this.defaults[e]=t}}]),e}(),r=new i;t.exports=function(){return r}}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],22:[function(e,t,n){(function(n){var i=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,r=e(\"./connection-instance.js\"),s=new r,o={},a=function(e){return\"/shared-entities/\"+e},u={timezone:{store:function(e){var t=e.current_time,n=e.timezone,i=Date.now(),r=i-t;return{server_time:t,name:n,current_time:i,offset:r}}}},c=function(){function e(){throw _classCallCheck(this,e),new Error(\"singletone\")}return _createClass(e,null,[{key:\"store\",value:function(e,t,n){var r=u.hasOwnProperty(e)?u[e].store(t):t;\"replace\"==n?o[e]=r:o[e]=i.defaults(o[e],r),this.emit(\"update.\"+e,o[e])}},{key:\"get\",value:function(e,t){return e&&!t?o[e]:o.hasOwnProperty(e)?o[e][t]:void 0}},{key:\"request\",value:function(e,t,n){var r=this;return this._prepocessRequest(e),i.isArray(e)?Promise.map(e,function(e){return r._request(e.name,e.params,e.method)}):this._request(e,t,n)}},{key:\"_prepocessRequest\",value:function(e){if(i.isArray(e)){var t=i.remove(e,function(e){return i.has(e,\"params.department\")&&i.isArray(e.params.department)});i.forEach(t,function(t){i.forEach(t.params.department,function(n){var r=i.cloneDeep(t);r.params.department=n,e.push(r)})})}}},{key:\"_request\",value:function(e,t,n){var i=this,r=a(e);return s.request(r,t).then(function(e){return i.store(e.namespace,e.entities,n),!0})}},{key:\"on\",value:function(e,t){this.cbs=this.cbs||{},this.cbs[e]=this.cbs[e]||[],this.cbs[e].push(t)}},{key:\"emit\",value:function(e,t){var n=this,r=i.get(this.cbs,e);r&&i.forEach(r,function(e){return e.call(n,t)})}}]),e}();t.exports=c}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"./connection-instance.js\":24}],23:[function(e,t,n){(function(e){function n(e,t,n){var i=void 0,r=void 0,o=Date.now(),c=new s(function(e,t){i=e,r=t}).timeout(n||a,\"operation timeout\");return{uri:e,promise:c,resolve:function(t){u&&u.storeNetworkStat(e,o),i(t)},reject:r}}function i(e,t){0!==e.indexOf(\"http\")&&(e=\"http://\"+e);var i=[],u=0,c=!1,l=!1,f=void 0,h=void 0,d=void 0,p=0,y=!1,v=function(e){return console.log(\"disconnected:\",e)},g=function(e){return console.log(\"restored:\",e)};return{name:\"socket\",startHeartbeatCounter:function(){y&&clearInterval(y),y=setInterval(function(){p+=1,p>5&&(p=0,console.log(\"no heartbeat, reconnecting\"),c.connected&&c.disconnect(),c.connect())},12e3)},lazyInit:function(){var n=this;return c?c.connect():(c=o.connect(e+\":\"+t),c.io.timeout(1e4),c.on(\"connect\",function(){c.emit(\"message\",{uri:\"/auth\",token:l})}),c.on(\"disconnect\",v.bind(this)),c.on(\"heartbeat\",function(e){p=p>0?p-1:0}),c.on(\"auth-accepted\",function(e){f(!0),g(),n.resubscribe().then(function(e){return console.log(\"subs restored \",e.length)}),n.startHeartbeatCounter()}),void c.on(\"message\",function(e){if(!e||!e.request_id||!i[e.request_id])return!1;var t=e.request_id,n=i[t];return e.state||(console.log(n),console.log(\"error %s# reason %s\",e.code,e.reason)),n.promise.isPending()?e.state?n.resolve(e.value):n.reject(r.pick(e,[\"reason\",\"code\"])):void 0}))},resubscribe:function(){var e=this;return console.log(\"restore subscriptions\"),s.all(r.map(this.subscriptions,function(t,n){return e.request(\"/subscribe\",{event:n})}))},storeSubscribtion:function(e){this.subscriptions=this.subscriptions||{},this.subscriptions[e]=!0,console.log(\"subscription stored:\",this.subscriptions)},removeSubscribtion:function(e){this.subscriptions&&(delete this.subscriptions[e],console.log(\"subscription removed:\",this.subscriptions))},close:function(){y&&clearInterval(y),c.disconnect()},onDisconnect:function(e){v=e},onRestore:function(e){g=e},auth:function(e){var t=this;return l=e,d=new s(function(e,t){f=e,h=t}).timeout(a,\"operation timeout\"),d[\"catch\"](function(e){console.log(\"connection closed\"),t.close()}),this.lazyInit(),d},request:function(e,t){return d.then(function(){return t=t||{},console.log(\"request\",e,t),u=(u+1)%1e4,t.request_id=u,c.emit(\"message\",{uri:e,data:t,request_id:u}),i[u]=new n(e,u),i[u].promise})},subscribe:function(e,t){var n=this;return this.request(\"/subscribe\",{event:e}).then(function(i){return console.log(\"subscribed on\",e),n.storeSubscribtion(e),c.on(e,t),!0})},unsubscribe:function(e,t){var n=this;return this.request(\"/unsubscribe\",{event:e}).then(function(i){return n.removeSubscribtion(e),c.off(e,t),!0})}}}var r=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof e?e._:null,s=\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof e?e.Promise:null,o=\"undefined\"!=typeof window?window.io:\"undefined\"!=typeof e?e.io:null,a=localStorage.getItem(\"debug_timeout\")||15e3,u=!1;i.setStatGrabber=function(e){u=e},t.exports=i}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],24:[function(e,t,n){var i=e(\"./Connection.js\"),r=new i;t.exports=function(){return r}},{\"./Connection.js\":17}],25:[function(e,t,n){(function(n){var i=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,r=(\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof n?n.Promise:null,\"undefined\"!=typeof window?window.moment:\"undefined\"!=typeof n?n.moment:null),s=e(\"../utils/seconds-to-time.js\"),o=e(\"../utils/seconds-to-full-time.js\"),a=e(\"./access-objects/SharedEntities.js\"),u=function(){function e(t,n){_classCallCheck(this,e),this.queue=n,i.defaults(this,t),this.utc_booking_date=t.booking_date,this.raw_label=this.label,this.inheritance_level&&(this.label=this.label+\" / \"+this.inheritance_level)}return _createClass(e,[{key:\"processFieldList\",value:function(){var e=this.user_info_description||{},t=i.defaults(e,a.get(\"user-info-fields\"));return i.reduce(this.user_info,function(e,n,r){return t.hasOwnProperty(r)&&e.push({label:i.get(t,[r,\"label\"]),value:n}),e},[])}},{key:\"hasEvent\",value:function(e){return!!i.find(this.history,[\"event_name\",e])}},{key:\"getWaitingTime\",value:function(){if(\"registered\"!=this.state||this.hasEvent(\"restore\"))return\"\";var e=this.secondsFromDayStart(),t=this.is_prebook?i.head(this.time_description):this.secondsFromDayStart(this.booking_date);return t>e?\"\":o(e-t)}},{key:\"secondsFromDayStart\",value:function(e){var t=a.get(\"timezone\");return e=e||Date.now()-t.offset,r(e).tz(t.name).diff(r.tz(t.name).startOf(\"day\"),\"seconds\")}},{key:\"getId\",value:function(){return this.id||this[\"@id\"]}},{key:\"getLabel\",value:function(){return this.label}},{key:\"getHistory\",value:function(){return this.history}},{key:\"returnToQueue\",value:function(){var e=\"open\";return this.queue.changeState(e,this)}},{key:\"priorityUp\",value:function(){return this.queue.changePriority(1,this)}},{key:\"priorityDown\",value:function(){return this.queue.changePriority(-1,this)}},{key:\"arrived\",value:function(){var e=\"process\";return this.queue.changeState(e,this)}},{key:\"close\",value:function(){var e=\"close\";return this.queue.changeState(e,this)}},{key:\"remove\",value:function(){var e=\"remove\";return this.queue.changeState(e,this)}},{key:\"register\",value:function(){return this.queue.registerTicket(this)}},{key:\"restore\",value:function(){var e=\"restore\";return this.queue.changeState(e,this)}},{key:\"postpone\",value:function(){var e=this,t=\"postpone\";return this.queue.changeState(t,this).then(function(t){return t.success&&(e.state=t.ticket.state),t})}},{key:\"callAgain\",value:function(){return this.queue.callAgain(this)}},{key:\"byId\",value:function(){return this.queue.getTicketById(this)}},{key:\"register\",value:function(){return this.queue.registerTicket(this)}},{key:\"field_list\",get:function(){return this.processFieldList()}},{key:\"booking_date\",get:function(){return r.utc(this.utc_booking_date).valueOf()}},{key:\"is_prebook\",get:function(){return this.hasEvent(\"book\")}},{key:\"is_activated\",get:function(){return this.hasEvent(\"activate\")}},{key:\"is_postopned\",get:function(){return this.hasEvent(\"postpone\")}},{key:\"is_routed\",get:function(){return this.hasEvent(\"route\")||!!this.inherits}},{key:\"just_routed\",get:function(){var e=i.last(this.history),t=i.get(e,\"event_name\");return\"route\"==t}},{key:\"prebook_time\",get:function(){return!!i.isArray(this.time_description)&&{start:s(this.time_description[0]),end:s(this.time_description[1])}}}]),e}();t.exports=u}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../utils/seconds-to-full-time.js\":41,\"../utils/seconds-to-time.js\":42,\"./access-objects/SharedEntities.js\":22}],26:[function(e,t,n){(function(n){var i=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,r=\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof n?n.Promise:null,s=e(\"eventemitter2\").EventEmitter2,o=e(\"../access-objects/SharedEntities.js\"),a=e(\"../access-objects/connection-instance.js\"),u=new a,c={\"default\":\"{event_name}.{org_chain}.{owner_id}\",\"office.average-waiting-time\":\"{event_name}.{org_chain}\",\"office.max-waiting-time\":\"{event_name}.{org_chain}\"},l=function(e){function t(e,n){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,{maxListeners:100}));return i.user=e,i.type=n,i.stored_subscriptions=[],i}return _inherits(t,e),_createClass(t,[{key:\"init\",value:function(e,t){var n=this;this.label=t.label,this.id=e,this.fields=t,console.log(\"init\",e);var i=\"/\"+this.type+\"/bootstrap\";return u.request(i,{workstation:e}).then(function(e){return n.bootstrap(e)}).then(function(){return n.getShared()}).then(function(){return n.middleware()}).then(function(){n.active=!0}).then(function(){return n.ready()})}},{key:\"getAllowedDepartments\",value:function(e){var t=i.get(this.user,[\"fields\",\"permissions\",e]),n=i.reduce(t,function(e,t,n){return t&&e.push(n),e},[]);return n}},{key:\"leave\",value:function(){var e=this;return u.request(\"/workstation/leave\",{workstation:this.id}).then(function(){return e.cleanUp()}).then(function(){return e.active=!1,e.id})}},{key:\"ready\",value:function(){return u.request(\"/\"+this.type+\"/ready\",{workstation:this.getId()})}},{key:\"getId\",value:function(){return this.id}},{key:\"getShared\",value:function(){return!0}},{key:\"middleware\",value:function(){return!0}},{key:\"cleanUp\",value:function(){return this.removeAllListeners(),!0}},{key:\"bootstrap\",value:function(e){var t=this;return i.has(e,\"workstation\")&&i.forEach(e.workstation,function(e,n){return i.set(t,[\"fields\",n],e)}),!0}},{key:\"subscriptionName\",value:function(e){var t=this.makeOrgChain(e),n=i.isString(e)?e:e.name,r=i.isString(e)?{}:e,s=r.owner_id||this.user.id;return this.templatize({event_name:n,org_chain:t,owner_id:s})}},{key:\"makeOrgChain\",value:function(e){var t=i.map(o.get(\"hierarchy\"),\"id\");return i.has(e,\"department\")&&(t[0]=e.department),i.has(e,\"office\")&&(t[1]=e.office||t[1]),i.join(i.reverse(t),\".\")}},{key:\"templatize\",value:function(e){var t=c[e.event_name]||c[\"default\"];return i.reduce(e,function(e,t,n){return e.replace(\"{\"+n+\"}\",t)},t)}},{key:\"subscribe\",value:function(e,t){var n=this,i=this.subscriptionName(e),r=e.expose_as?function(i){t&&t(i),n.emit(e.expose_as,i)}:t;return this.stored_subscriptions.push({name:i,callback:r,original:t}),u.subscribe(i,r)}},{key:\"unsubscribe\",value:function(e,t){if(!t)return this.unsubscribeByName(e);var n=this.subscriptionName(e),r=i.find(this.stored_subscriptions,[\"original\",t]).callback;return this._unsub(n,r)}},{key:\"_unsub\",value:function(e,t){var n=this;return u.unsubscribe(e,t).then(function(){return i.remove(n.stored_subscriptions,[\"callback\",t]),!0})}},{key:\"unsubscribeByName\",value:function(e){var t=this;if(!e)return this.unsubscribeAll();var n=i.chain(this.stored_subscriptions).filter([\"name\",e]).map(function(e){return t._unsub(e.name,e.callback)}).value();return r.all(n)}},{key:\"unsubscribeAll\",value:function(){var e=this;console.log(\"unsubscirbe all\");var t=i.map(this.stored_subscriptions,function(t){return e._unsub(t.name,t.callback)});return r.all(t)}},{key:\"getId\",value:function(){return this.id}}]),t}(s);t.exports=l}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,eventemitter2:3}],27:[function(e,t,n){(function(n){var i=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,r=\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof n?n.Promise:null,s=e(\"../access-objects/connection-instance.js\"),o=(e(\"../ticket.js\"),e(\"./TicketRegister.js\")),a=e(\"../access-objects/SharedEntities.js\"),u=new s,c=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,\"call-center\"));return n.refreshTicket(),n}return _inherits(t,e),_createClass(t,[{key:\"bootstrap\",value:function(e){var t=this,n=i.castArray(this.fields.attached_terminal),s=this.getAllowedDepartments(\"can-book\"),o=\"/terminal/bootstrap\",a=i.map(n,function(e){return u.request(o,{workstation:e})});return r.all(a).then(function(e){return t.terminals=i.reduce(e,function(e,n){return~s.indexOf(n.workstation.attached_to)?(t._applyCustomFieldsTransform(n),e.push(n),e):e},[]),!0})}},{key:\"getShared\",value:function(){var e={workstation:this.getId()},t=this.getAllowedDepartments(\"can-book\"),n=[{name:\"timezone\",params:e},{name:\"office\",params:e},{name:\"services\",params:{department:t}},{name:\"organization-chain\",params:e}];return i.forEach(t,function(e){var t={department:e};n.push({name:\"departments\",params:t,method:\"merge\"})}),a.request(n)}}]),t}(o);t.exports=c}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,\"../ticket.js\":25,\"./TicketRegister.js\":39}],28:[function(e,t,n){(function(n){var i={live:{tickets:[],count:0},postponed:{tickets:[],count:0}},r=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,s=\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof n?n.Promise:null,o=e(\"../access-objects/connection-instance.js\"),a=(e(\"../ticket.js\"),e(\"./TicketManager.js\")),u=e(\"../access-objects/SharedEntities.js\"),c=new o,l=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,\"control-panel\"))}return _inherits(t,e),_createClass(t,[{key:\"bootstrap\",value:function(e){return console.log(\"bootstrap:\",e),this.emit(\"queue.update\",{live:{count:0,tickets:[]},postponed:{count:0,tickets:[]}}),!0}},{key:\"getShared\",value:function(){var e={workstation:this.getId()},t=[{name:\"timezone\",params:e},{name:\"office\",params:e},{name:\"services\",params:e},{name:\"organization-chain\",params:e}];return u.request(t)}},{key:\"middleware\",value:function(){var e=this,n=function(){return e.ready()},s=r.floor(1e3*Math.random());return c.on(\"connection-restore\",n),this.cleanUp=function(){return _get(Object.getPrototypeOf(t.prototype),\"cleanUp\",e).call(e),c.off(\"connection-restore\",n),e.unsubscribe()},this.subscribe({name:\"command.logout\",owner_id:this.getId(),expose_as:\"command-logout\"},function(){}),this.subscribe({name:\"office.max-waiting-time\"},function(t){r.set(t,[\"data\",\"param\"],\"max-waiting-time\"),e.emit(\"office-status-change\",t.data)}),this.subscribe({name:\"queue.head\",owner_id:this.getId()},function(t){r.defaultsDeep(t,{data:i}),console.log(\"<SUB#%s> Queue Head Arrived:\",s,t);var n=r.mapValues(t.data,function(t,n){return\"room\"===n?t:{count:t.count,tickets:r.map(t.tickets,function(t){return e.makeTicket(t)})}});e.emit(\"queue.update\",n)})}},{key:\"onUpdate\",value:function(e){return this.on(\"queue.update\",e)}},{key:\"getNext\",value:function(){var e=this;return this.user.isLogged()?this.wakeUpNeo().then(function(){return c.request(\"/queue/ticket-next\",{workstation:e.getId()})}).then(function(t){if(!t.success)throw new Error(\"can not get ticket\");return e.makeTicket(t.ticket)}):s.reject(\"not logged\")}},{key:\"getQueuePage\",value:function(e,t,n){return this.user.isLogged()?c.request(\"/queue/list\",{workstation:this.getId(),state:e,limit:t,offset:n}):s.reject(\"not logged\")}},{key:\"changeState\",value:function(e,n){var i=this;return this.wakeUpNeo().then(function(){return _get(Object.getPrototypeOf(t.prototype),\"changeState\",i).call(i,e,n)})}},{key:\"routeTicket\",value:function(e,n){var i=this;return this.wakeUpNeo().then(function(){return _get(Object.getPrototypeOf(t.prototype),\"routeTicket\",i).call(i,e,n)})}},{key:\"wakeUpNeo\",value:function(){return this.user.isPaused()?this.user.resume():s.resolve(!0)}}]),t}(a);t.exports=l}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,\"../ticket.js\":25,\"./TicketManager.js\":38}],29:[function(e,t,n){(function(n){var i=e(\"./BaseWorkstation.js\"),r=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,\"digital-display\"));return n.request_shared=[\"timezone\",\"office\",\"services\",\"organization-chain\"],n}return _inherits(t,e),_createClass(t,[{key:\"middleware\",value:function(){var e=this;return this.subscribe({name:\"digital-display.command\",owner_id:this.getId()},function(t){console.log(\"<DD> new command:\",t);var i=t.data;e.emit(\"command\",new n(i.data,\"hex\"))})}}]),t}(i);t.exports=r}).call(this,e(\"buffer\").Buffer)},{\"./BaseWorkstation.js\":26,buffer:2}],30:[function(e,t,n){var i=e(\"../access-objects/Settings.js\"),r=e(\"./BaseWorkstation.js\"),s=e(\"../ticket.js\"),o=e(\"../access-objects/SharedEntities.js\"),a=e(\"../access-objects/connection-instance.js\"),u=(new a,new i),c=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,\"operator-display\")),i=u.getItem(\"operator_arm_id\");return n.parent=i,n}return _inherits(t,e),_createClass(t,[{key:\"bootstrap\",value:function(e){return console.log(\"<OD> BOOT:\",e),!0}},{key:\"middleware\",value:function(){var e=this;return this.subscribe({name:\"ticket.*\",owner_id:this.parent},function(t){e.emit(\"parent.action\",{ticket:t.data})})}},{key:\"getShared\",value:function(){var e={workstation:this.getId()},t=this.fields.attached_to,n=[{name:\"office\",params:e},{name:\"organization-chain\",params:e},{name:\"workstations\",params:{department:t}}];return o.request(n)}},{key:\"makeTicket\",value:function(e){var t=new s(e,this);return t}}]),t}(r);t.exports=c},{\"../access-objects/Settings.js\":21,\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,\"../ticket.js\":25,\"./BaseWorkstation.js\":26}],31:[function(e,t,n){var i=e(\"../access-objects/connection-instance.js\"),r=e(\"./BaseWorkstation.js\"),s=e(\"../ticket.js\"),o=e(\"../access-objects/SharedEntities.js\"),a=new i,u=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,\"pandora-box\"))}return _inherits(t,e),_createClass(t,[{key:\"bootstrap\",value:function(e){return console.log(\"<Pandora Model> BOOT:\",e),!0}},{key:\"getShared\",value:function(){var e={workstation:this.getId()},t=[{name:\"timezone\",params:e},{name:\"office\",params:e},{name:\"organization-chain\",params:e},{name:\"services\",params:e}];return o.request(t)}},{key:\"getPlacementSnapshot\",value:function(e){var t=this;return a.request(\"/pandora-box/placement-snapshot\",{workstation:this.getId(),dedicated_date:e}).then(function(e){return _.map(e,function(e){return t.makeTicket(e)})})}},{key:\"makeTicket\",value:function(e){\nvar t=new s(e,this);return t}}]),t}(r);t.exports=u},{\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,\"../ticket.js\":25,\"./BaseWorkstation.js\":26}],32:[function(e,t,n){var i=e(\"../access-objects/Settings.js\"),r=e(\"./BaseWorkstation.js\"),s=e(\"../ticket.js\"),o=e(\"../access-objects/SharedEntities.js\"),a=e(\"../access-objects/connection-instance.js\"),u=new a,c=new i,l=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,\"qa\"))}return _inherits(t,e),_createClass(t,[{key:\"bootstrap\",value:function(e){console.log(\"<QA> BOOT:\",e);var t=this.user.getAvailableWorkstations()[this.getId()],n=t.hold_screen_design,i=c.getItem(\"data_server\"),r=c.getItem(\"data_port\"),s=\"http://\"+(r?i+\":\"+r:i);return this.hold_screen_design=s+n,!0}},{key:\"middleware\",value:function(){var e=this,t=c.getItem(\"operator_arm_id\"),n=[\"processing\",\"postpone\",\"closed\"];return _.map(n,function(n){return e.subscribe({name:\"ticket.\"+n,owner_id:t},function(t){e.emit(\"parent.action\",{ticket:t.data,action:n})})})}},{key:\"storeQAResults\",value:function(e,t){return u.request(\"/qa/answers\",{workstation:this.getId(),answers:e,code:t})}},{key:\"getQA\",value:function(e){return u.request(\"/qa/questions\",{code:e,device_type:this.type})}},{key:\"getShared\",value:function(){var e={workstation:this.getId()},t=[{name:\"timezone\",params:e},{name:\"office\",params:e},{name:\"organization-chain\",params:e},{name:\"services\",params:e}];return o.request(t)}},{key:\"makeTicket\",value:function(e){var t=new s(e,this);return t}}]),t}(r);t.exports=l},{\"../access-objects/Settings.js\":21,\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,\"../ticket.js\":25,\"./BaseWorkstation.js\":26}],33:[function(e,t,n){var i=e(\"./TicketManager.js\"),r=e(\"../access-objects/connection-instance.js\"),s=new r,o=e(\"../access-objects/SharedEntities.js\"),a=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,\"reception\"))}return _inherits(t,e),_createClass(t,[{key:\"middleware\",value:function(){var e=this,t=function(t){t.data&&e.emit(\"ticket-changed\",e.makeTicket(t.data))},n=_.get(this.user,[\"fields\",\"permissions\",\"can-manage\"]),i=_.reduce(n,function(e,t,n){return t&&e.push(n),e},[]);_.forEach(i,function(n){var i=_.get(o.get(\"departments\",n),\"unit_of\");e.subscribe({name:\"ticket.*\",owner_id:\"*\",department:n,office:i},t)})}},{key:\"getShared\",value:function(){var e={workstation:this.getId()},t=_.get(this.user,[\"fields\",\"permissions\",\"can-manage\"]),n=_.reduce(t,function(e,t,n){return t&&e.push(n),e},[]),i=[{name:\"timezone\",params:e},{name:\"services\",params:{department:n}},{name:\"workstations\",params:{department:n}},{name:\"operators\",params:{department:n}},{name:\"departments\",params:{department:n}},{name:\"user-info-fields\",params:e}];return o.request(i)}},{key:\"getServiceInfo\",value:function(e){return s.request(\"/reception/service-info\",e)}},{key:\"getServiceDetails\",value:function(e){var t=this;return s.request(\"/reception/service-details\",e).then(function(e){return _.isEmpty(e)?[]:_.map(e,function(e){return t.makeTicket(e)})})}},{key:\"getWorkstationInfo\",value:function(e){return s.request(\"/reception/workstation-info\",e)}},{key:\"getAvailableSlots\",value:function(e){return s.request(\"/prebook/service-stats\",e)}},{key:\"turnoffWorkstation\",value:function(e){return e.workstation=this.getId(),s.request(\"/workstation/user-logout\",e)}},{key:\"queryTickets\",value:function(e){var t=this,n=\"@id\"==e.field?this.queryOne(e.text):s.request(\"/reception/query-tickets\",e);return e.department=e.department||_.castArray(this.fields.attached_to),n.then(function(e){return _.isEmpty(e)?[]:_.map(e,function(e){return t.makeTicket(e)})})}},{key:\"queryOne\",value:function(e){return s.request(\"/ticket/by-id\",{ticket:e})}}]),t}(i);t.exports=a},{\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,\"./TicketManager.js\":38}],34:[function(e,t,n){var i=e(\"./CallCenterWorkstation.js\"),r=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return n.route=\"registry\",n}return _inherits(t,e),t}(i);t.exports=r},{\"./CallCenterWorkstation.js\":27}],35:[function(e,t,n){var i=e(\"./BaseWorkstation.js\"),r=e(\"../access-objects/connection-instance.js\"),s=new r,o=e(\"../access-objects/SharedEntities.js\"),a=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,\"reports\"))}return _inherits(t,e),_createClass(t,[{key:\"getShared\",value:function(){var e={workstation:this.getId()},t=_.get(this.user,[\"fields\",\"permissions\",\"can-report\"]),n=_.reduce(t,function(e,t,n){return t&&e.push(n),e},[]),i=[{name:\"timezone\",params:e},{name:\"services\",params:{department:n}},{name:\"qa-questions\",params:e},{name:\"operators\",params:{department:n}}];return _.forEach(n,function(e){var t={department:e};i.push({name:\"departments\",params:t})}),o.request(i)}},{key:\"getTable\",value:function(e){return s.request(\"/reports/get-table\",e,\"http\").then(function(e){return e.value})}}]),t}(i);t.exports=a},{\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,\"./BaseWorkstation.js\":26}],36:[function(e,t,n){var i=e(\"./BaseWorkstation.js\"),r=e(\"../access-objects/SharedEntities.js\"),s=e(\"../access-objects/connection-instance.js\"),o=e(\"../ticket.js\"),a=new s,u=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return n.user=e,n.type=\"roomdisplay\",n.queue=[],n.queue_to_play=[],n.queue_length=40,n}return _inherits(t,e),_createClass(t,[{key:\"middleware\",value:function(){var e=this;this.default_voice_duration=this.fields.default_voice_duration||4e4;var t=_.isArray(this.fields.history_enabled)?this.fields.history_enabled:[];return this.fields.history_enabled===!1&&(t=[\"postpone\",\"processing\",\"route\",\"expire\",\"close\"]),console.log(\"<RD> Drop events list:\",t),_.isEmpty(t)||!function(){var n=function(t){console.log(\"<RD> Ticket event\",t);var n=t.data,i=_.get(n,\"id\");e.queue=_.filter(e.queue,function(e){return _.get(e,\"id\")!=i});var r=_.head(e.queue_to_play),s=!!r&&r.id;_.remove(e.queue_to_play,function(e){return _.get(e,\"id\")!=s&&_.get(e,\"id\")==i}),e.emit(\"queue.change\")};_.forEach(t,function(t){return e.subscribe({name:\"ticket.\"+t,owner_id:\"*\"},n)})}(),this.subscribe({name:\"roomdisplay.command\",owner_id:this.getId()},function(t){console.log(\"ticket called with data:\",t);var n=t.data,i=(_.get(n.ticket,\"id\"),new o(n.ticket));i.workstation=n.workstation,i.voice=n.voice,i.voice_duration=n.voice_duration||e.default_voice_duration,e.addToQueue(i),e.emit(\"queue.change\")})}},{key:\"getShared\",value:function(){var e={workstation:this.getId()},t=[{name:\"timezone\",params:e},{name:\"office\",params:e},{name:\"organization-chain\",params:e}];return r.request(t)}},{key:\"makeTicket\",value:function(e){var t=new o(e,this);return t}},{key:\"onChange\",value:function(e){this.on(\"queue.change\",e)}},{key:\"autoFlush\",value:function(){var e=this;this.flush_interval&&clearInterval(this.flush_interval),this.queue_to_play.length&&(console.log(\"Auto flush every 45 sec\"),this.flush_interval=setInterval(function(){console.log(\"Autoflush\"),e.queue_to_play.shift(),e.emit(\"queue.change\")},45e3))}},{key:\"isSameID\",value:function(e,t){return e instanceof o&&t instanceof o&&e.getId()==t.getId()}},{key:\"isSameWorkstation\",value:function(e,t){return e instanceof o&&t instanceof o&&e.workstation.id==t.workstation.id}},{key:\"played\",value:function(e){var t=this;return console.log(\"report played\",e.getId()),a.request(\"/roomdisplay/report-played\",{ticket:e.getId(),success:!0}).then(function(n){var i=n.success,r=n.ticket;return console.log(\"success\",i,\"ticket\",r),t.checkTicketState(r),t.clearQueueToPlay(e)})}},{key:\"checkTicketState\",value:function(e){var t=this,n=this.fields.history_enabled;n!==!1&&!_.isArray(n)||\"closed\"!=e.state||!function(){var n=_.get(e,\"id\");t.queue=_.filter(t.queue,function(e){return _.get(e,\"id\")!=n}),t.emit(\"queue.change\")}()}},{key:\"clearQueueToPlay\",value:function(e){var t=this;_.remove(this.queue_to_play,function(n){return t.isSameID(n,e)&&t.isSameWorkstation(n,e)}),this.emit(\"queue.change\"),this.autoFlush()}},{key:\"failed\",value:function(e){var t=this;return console.log(\"report failed\",e.getId()),a.request(\"/roomdisplay/report-played\",{ticket:e.getId(),success:!1}).then(function(){return t.clearQueueToPlay(e)})}},{key:\"addToQueue\",value:function(e){var t=this;0==this.queue_to_play.length&&this.autoFlush(),_.remove(this.queue_to_play,function(n,i){return i&&t.isSameID(n,e)&&!t.isSameWorkstation(n,e)}),this.queue_to_play.push(e),_.remove(this.queue,function(n){return t.isSameID(n,e)}),this.queue.unshift(e),this.queue=_.slice(this.queue,0,this.queue_length)}}]),t}(i);t.exports=u},{\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,\"../ticket.js\":25,\"./BaseWorkstation.js\":26}],37:[function(e,t,n){(function(n){var i=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,r=(\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof n?n.Promise:null,e(\"../access-objects/connection-instance.js\")),s=(e(\"../ticket.js\"),e(\"./TicketRegister.js\")),o=e(\"../access-objects/SharedEntities.js\"),a=new r,u=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,\"terminal\"));return n.refreshTicket(),n}return _inherits(t,e),_createClass(t,[{key:\"bootstrap\",value:function(e){return console.log(\"TERMINAL BOOT:\",e),this._applyCustomFieldsTransform(e),this.service_views=e.views,this.fields_model=e.fields_model,this.reload_interval=60*e.workstation.reload_interval*1e3,this.attachValidators(),!0}},{key:\"getShared\",value:function(){var e={workstation:this.getId()},t=[{name:\"timezone\",params:e},{name:\"office\",params:e},{name:\"services\",params:e},{name:\"organization-chain\",params:e},{name:\"user-info-fields\",params:e}];return o.request(t)}},{key:\"attachValidators\",value:function(){var e=this;i.forEach(this.fields_model,function(t){if(!t.validate)return!0;var n=i.isArray(t.validate)?t.validate:[t.validate];t.validate=i.map(n,function(t){if(i.isString(t)&&i.isFunction(e[t]))return e[t].bind(e)})})}},{key:\"getQA\",value:function(e){var t=this.type;return a.request(\"/qa/questions\",{code:e,device_type:t})}},{key:\"storeQAResults\",value:function(e,t){var n=this.getId();return a.request(\"/qa/answers\",{workstation:n,answers:e,code:t})}},{key:\"getServiceViews\",value:function(){return this.service_views}},{key:\"getFieldsModel\",value:function(){return this.fields_model}}]),t}(s);t.exports=u}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../access-objects/SharedEntities.js\":22,\"../access-objects/connection-instance.js\":24,\"../ticket.js\":25,\"./TicketRegister.js\":39}],38:[function(e,t,n){var i=e(\"./BaseWorkstation.js\"),r=e(\"../access-objects/connection-instance.js\"),s=e(\"../ticket.js\"),o=new r,a=function(e){function t(e,n){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,n))}return _inherits(t,e),_createClass(t,[{key:\"makeTicket\",value:function(e){var t=new s(this.detachPrivateFields(e),this);return t}},{key:\"detachPrivateFields\",value:function(e){return _.forEach(e.user_info_description,function(t,n){!!t[\"private\"]&&_.unset(e.user_info,n)}),e}},{key:\"getSessionTickets\",value:function(e){var t=this;return o.request(\"ticket/session-tickets\",e).then(function(e){if(!e.success)throw new Error(\"can not get tickets\");return _.map(e.tickets,function(e){return t.makeTicket(e)})})}},{key:\"changeState\",value:function(e,t){var n=this;if(console.log(\"<TM> changing state to %s\",e),!this.user.isLogged())return Promise.reject(\"not logged\");var i=\"/queue/ticket-\"+e;return o.request(i,{ticket:t.getId(),workstation:this.getId()}).then(function(t){if(console.log(t),!t.success)throw new Error(\"<TM> can not change state to \"+e);return n.makeTicket(t.ticket)})}},{key:\"changePriority\",value:function(e,t){var n=this;if(console.log(\"<TM> changing priority to %s\",e),!this.user.isLogged())return Promise.reject(\"not logged\");var i=\"/queue/ticket-change-priority\";return o.request(i,{ticket:t.getId(),workstation:this.getId(),diff:e}).then(function(e){if(!e.success)throw new Error(\"can not change priority\");return n.makeTicket(e.ticket)})}},{key:\"routeTicket\",value:function(e,t,n){var i=this;return o.request(\"/queue/set-route\",{ticket:e.getId(),workstation:n||this.getId(),service:t.service,destination:t.workstation}).then(function(e){if(!e.success)throw new Error(\"can not change priority\");return i.makeTicket(e.ticket)})}},{key:\"registerTicket\",value:function(e){var t=this;if(!this.user.isLogged())return Promise.reject(\"not logged\");var n=e.getId();return o.request(\"/queue/ticket-print\",{ticket:n,workstation:this.getId(),reason:\"reception registration\"}).then(function(e){return t.transformPrintData(e)})}},{key:\"transformPrintData\",value:function(e){var t=this;return _.isEmpty(e.ticket)||(e.ticket=_.isArray(e.ticket)?_.map(e.ticket,function(e){return t.makeTicket(e)}):this.makeTicket(e.ticket)),e}},{key:\"postponeTicket\",value:function(e){if(!this.user.isLogged())return Promise.reject(\"not logged\");e instanceof s?e.getId():e;return this.changeState(\"postpone\",e)}},{key:\"getAvailableRoutes\",value:function(e,t){return o.request(\"/queue/available-routes\",{ticket:e.getId(),ignore_routs:!!t})}},{key:\"getTicketById\",value:function(e){var t=this;if(!this.user.isLogged())return Promise.reject(\"not logged\");var n=e instanceof s?e.getId():e;return this.wakeUpNeo().then(function(){return o.request(\"/queue/ticket-by-id\",{ticket:n,workstation:t.getId()})}).then(function(e){if(!e.success)throw new Error(\"can not get ticket\");return t.makeTicket(e.ticket)})}},{key:\"callAgain\",value:function(e){return this.user.isLogged()?o.request(\"/queue/call-again\",{ticket:e.getId(),workstation:this.getId()}):Promise.reject(\"not logged\")}}]),t}(i);t.exports=a},{\"../access-objects/connection-instance.js\":24,\"../ticket.js\":25,\"./BaseWorkstation.js\":26}],39:[function(e,t,n){(function(n){var i=\"undefined\"!=typeof window?window._:\"undefined\"!=typeof n?n._:null,r=\"undefined\"!=typeof window?window.Promise:\"undefined\"!=typeof n?n.Promise:null,s=e(\"../access-objects/connection-instance.js\"),o=e(\"../ticket.js\"),a=e(\"./BaseWorkstation.js\"),u=new s,c=function(e){function t(e,n){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,n))}return _inherits(t,e),_createClass(t,[{key:\"getTicketByPin\",value:function(e,t){var n=this,i=u.request(t?\"/ticket/history\":\"/ticket/by-code\",{code:e});return i.then(function(e){return!!e.success&&n.makeTicket(e.ticket)})}},{key:\"_applyCustomFieldsTransform\",value:function(e){var t=e.workstation.custom_fields||{};i.forEach(t,function(t,n){t===!1?e.fields_model[n].include=!1:t===!0&&e.fields_model[n]?e.fields_model[n].include=!0:i.isPlainObject(t)&&(e.fields_model[n]=t)})}},{key:\"makeTicket\",value:function(e,t){var n=t?this.detachPrivateFields(e):this.attachPrivateFields(e),i=new o(n,this);return i}},{key:\"detachPrivateFields\",value:function(e){return i.forEach(e.user_info_description,function(t,n){!!t[\"private\"]&&i.unset(e.user_info,n)}),e}},{key:\"attachPrivateFields\",value:function(e){return i.forEach(this.private_fields,function(t,n){e.user_info[n]=t}),e}},{key:\"refreshTicket\",value:function(e){var t=this.current_ticket_data?i.cloneDeep(this.current_ticket_data.priority):{};return this.current_ticket_data={service_count:i.isArray(e)?i.fill(Array(e.length),1):1,priority:t},e&&(this.current_ticket_data.service=e),this.current_ticket_data}},{key:\"preCheck\",value:function(){return this.checkAvailability(this.current_ticket_data)}},{key:\"registerTicket\",value:function(e){var t=this;if(!this.user.isLogged())return r.reject(\"not logged\");var n=e.getId();return u.request(\"/queue/ticket-register\",{ticket:n,workstation:this.getId(),reason:\"terminal registration\"}).then(function(e){return t.transformPrintData(e,!0)})}},{key:\"checkAvailability\",value:function(e){var t=i.cloneDeep(e);return t.workstation=t.workstation||this.getId(),u.request(\"/queue/ticket-observe\",t).then(function(e){return console.log(\"Observe ticket:\",e),e.success})}},{key:\"confirmTicket\",value:function(e){return this.confirm(e,!0)}},{key:\"confirmPrebook\",value:function(e){return this.confirm(e,!1)}},{key:\"confirm\",value:function(e,t,n){var i=this,r=this.postprocessFields(e,n),s=t?\"queue\":\"prebook\";return u.request(\"/\"+s+\"/ticket-confirm\",r).then(function(e){return console.log(e),i.transformPrintData(e)})}},{key:\"createPrivateFields\",value:function(e,t){var n=this,r=i.cloneDeep(e);return this.private_fields={},i.forEach(t,function(e,t){var i=e.key||t,s=!!e[\"private\"];if(!s)return!0;var o=r[i],a=md5(o);n.private_fields[i]=o,r[i]=a}),r}},{key:\"makeInfoDescription\",value:function(e){return i.transform(e,function(e,t,n){e[t.key||n]={\"private\":!!t[\"private\"],label:t.label}},{})}},{key:\"postprocessFields\",value:function(e,t){var n=this.createPrivateFields(e,t);return i.unset(n,\"start\"),i.unset(n,\"end\"),n.workstation=n.workstation||this.getId(),n.user_info_description=this.makeInfoDescription(t),n}},{key:\"prebookObserve\",value:function(e){return e.workstation=e.workstation||this.getId(),u.request(\"/prebook/ticket-observe\",e)}},{key:\"prebookAvailable\",value:function(e){return e.workstation=e.workstation||this.getId(),u.request(\"/prebook/available-days\",e)}},{key:\"transformPrintData\",value:function(e,t){var n=this;return!i.isEmpty(e.ticket)&&e.success&&(e.ticket=i.isArray(e.ticket)?i.map(e.ticket,function(e){return n.makeTicket(e,t)}):this.makeTicket(e.ticket,t)),e}},{key:\"addPriority\",value:function(e,t){this.current_ticket_data.priority[e]={certificate_id:t}}},{key:\"removePriority\",value:function(e,t){i.unset(this.current_ticket_data.priority,e)}},{key:\"dropPriorities\",value:function(){this.current_ticket_data.priority={}}}]),t}(a);t.exports=c}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../access-objects/connection-instance.js\":24,\"../ticket.js\":25,\"./BaseWorkstation.js\":26}],40:[function(e,t,n){t.exports={BaseWorkstation:e(\"./classes/workstations/BaseWorkstation.js\"),ControlPanelWorkstation:e(\"./classes/workstations/ControlPanelWorkstation.js\"),DigitalDisplayWorkstation:e(\"./classes/workstations/DigitalDisplayWorkstation.js\"),PandoraBoxWorkstation:e(\"./classes/workstations/PandoraBoxWorkstation.js\"),QaWorkstation:e(\"./classes/workstations/QaWorkstation.js\"),ReceptionWorkstation:e(\"./classes/workstations/ReceptionWorkstation.js\"),OperatorDisplayWorkstation:e(\"./classes/workstations/OperatorDisplayWorkstation.js\"),ReportsWorkstation:e(\"./classes/workstations/ReportsWorkstation.js\"),RoomdisplayWorkstation:e(\"./classes/workstations/RoomdisplayWorkstation.js\"),CallCenterWorkstation:e(\"./classes/workstations/CallCenterWorkstation.js\"),RegistryWorkstation:e(\"./classes/workstations/RegistryWorkstation.js\"),TerminalWorkstation:e(\"./classes/workstations/TerminalWorkstation.js\"),HttpConnectionMethod:e(\"./classes/access-objects/HTTPConnection.js\"),SocketConnection:e(\"./classes/access-objects/SocketConnection.js\"),SharedEntities:e(\"./classes/access-objects/SharedEntities.js\"),Connection:e(\"./classes/access-objects/Connection.js\"),connection:e(\"./classes/access-objects/connection-instance.js\"),settings:e(\"./classes/access-objects/Settings.js\"),History:e(\"./classes/access-objects/History.js\"),User:e(\"./classes/User.js\"),Ticket:e(\"./classes/ticket.js\"),Errors:e(\"./classes/access-objects/Errors.js\")}},{\"./classes/User.js\":16,\"./classes/access-objects/Connection.js\":17,\"./classes/access-objects/Errors.js\":18,\"./classes/access-objects/HTTPConnection.js\":19,\"./classes/access-objects/History.js\":20,\"./classes/access-objects/Settings.js\":21,\"./classes/access-objects/SharedEntities.js\":22,\"./classes/access-objects/SocketConnection.js\":23,\"./classes/access-objects/connection-instance.js\":24,\"./classes/ticket.js\":25,\"./classes/workstations/BaseWorkstation.js\":26,\"./classes/workstations/CallCenterWorkstation.js\":27,\"./classes/workstations/ControlPanelWorkstation.js\":28,\"./classes/workstations/DigitalDisplayWorkstation.js\":29,\"./classes/workstations/OperatorDisplayWorkstation.js\":30,\"./classes/workstations/PandoraBoxWorkstation.js\":31,\"./classes/workstations/QaWorkstation.js\":32,\"./classes/workstations/ReceptionWorkstation.js\":33,\"./classes/workstations/RegistryWorkstation.js\":34,\"./classes/workstations/ReportsWorkstation.js\":35,\"./classes/workstations/RoomdisplayWorkstation.js\":36,\"./classes/workstations/TerminalWorkstation.js\":37}],41:[function(e,t,n){t.exports=function(e){var t=_.floor(e/3600),n=_.floor(e%3600/60),i=e%60;return n=1==n.toString().length?\"0\"+n:n,t=1==t.toString().length?\"0\"+t:t,i=1==i.toString().length?\"0\"+i:i,t+\":\"+n+\":\"+i}},{}],42:[function(e,t,n){t.exports=function(e){var t=_.floor(e/3600),n=_.floor(e%3600/60);return n=1==n.toString().length?\"0\"+n:n,t=1==t.toString().length?\"0\"+t:t,t+\":\"+n}},{}]},{},[15]);"],"file":"browser.js","sourceRoot":"/source/"}